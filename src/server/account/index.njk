{% extends 'layouts/page.njk' %}

{% block content %}
  <div class="govuk-grid-row">
    <div class="govuk-grid-column-full">
      <div class="govuk-body" data-testid="app-page-body">
        {% if isDefraIdEnabled %}
          {% if authedUser and authedUser.displayName %}
            <div class="govuk-panel govuk-panel--confirmation" style="background-color: #f3f2f1; border: 2px solid #1d70b8;">
              <div class="govuk-panel__body" style="color: #0b0c0c;">
                {{ localise('account:greeting') }}, <strong>{{ authedUser.displayName }}</strong>
              </div>
            </div>
            <details class="govuk-details">
              <summary class="govuk-details__summary">
                <span class="govuk-details__summary-text">
                  View your account details
                </span>
              </summary>
              <div class="govuk-details__text">
                <dl class="govuk-summary-list">
                  {% for key, value in authedUser %}
                    <div class="govuk-summary-list__row">
                      <dt class="govuk-summary-list__key">{{ key }}</dt>
                      <dd class="govuk-summary-list__value">
                        <code>{{ value }}</code>
                      </dd>
                    </div>
                  {% endfor %}
                </dl>
              </div>
            </details>
          {% endif %}
        {% endif %}

        <span class="govuk-caption-xl">Home</span>
        <h1 class="govuk-heading-xl">{{ organisationName }}</h1>

        {% if hasReprocessing and hasExporting %}
          <nav class="govuk-tabs" data-module="govuk-tabs">
            <ul class="govuk-tabs__list">
              <li class="govuk-tabs__list-item govuk-tabs__list-item--selected">
                <a class="govuk-tabs__tab" href="#reprocessing">
                  Reprocessing
                </a>
              </li>
              <li class="govuk-tabs__list-item">
                <a class="govuk-tabs__tab" href="#exporting">
                  Exporting
                </a>
              </li>
            </ul>
          </nav>
        {% endif %}

        {% if hasReprocessing %}
          <div id="reprocessing">
            <h2 class="govuk-heading-l">Select site and material</h2>

            {% for site in reprocessingSites %}
              <h3 class="govuk-heading-m">{{ site.name }}</h3>

              {{ govukTable({
                head: [
                  {
                    text: "Material"
                  },
                  {
                    text: "Registration"
                  },
                  {
                    text: "Accreditation"
                  },
                  {
                    text: "Available waste balance (tonnes)",
                    format: "numeric"
                  },
                  {
                    text: ""
                  }
                ],
                rows: site.tableRows
              }) }}
            {% endfor %}
          </div>
        {% endif %}

        {% if hasExporting %}
          <div id="exporting" {% if hasReprocessing %}class="govuk-tabs__panel govuk-tabs__panel--hidden"{% endif %}>
            <h2 class="govuk-heading-l">Select site and material</h2>

            {% if exportingSites.length > 0 %}
              {% for site in exportingSites %}
                <h3 class="govuk-heading-m">{{ site.name }}</h3>

                {{ govukTable({
                  head: [
                    {
                      text: "Material"
                    },
                    {
                      text: "Registration"
                    },
                    {
                      text: "Accreditation"
                    },
                    {
                      text: "Available waste balance (tonnes)",
                      format: "numeric"
                    },
                    {
                      text: ""
                    }
                  ],
                  rows: site.tableRows
                }) }}
              {% endfor %}
            {% else %}
              <p class="govuk-body">No exporting sites available.</p>
            {% endif %}
          </div>
        {% endif %}
      </div>
    </div>
  </div>
{% endblock %}
